# Build Scripts for Demo/Static Deployment

This directory contains build scripts for creating demo builds of GTFS-Web frontends that can be deployed as static sites.

## Overview

The build process uses **demo mode** which:
- Sets `VITE_DEMO_MODE=true` during build
- Uses `axios-mock-adapter` instead of real API calls
- Loads data from `demo-data.json` (generated by `export-demo-data.js`)
- Builds with configurable base paths for static asset routing

## How Demo Mode Works

### 1. Build Configuration

Both `frontend/cms` and `frontend/web` have a `build:demo` script:

```json
"build:demo": "VITE_DEMO_MODE=true tsc && VITE_DEMO_MODE=true vite build --base=/gtfs-cms/"
```

This:
- Sets the `VITE_DEMO_MODE` environment variable
- Builds with TypeScript compilation
- Sets the base path for static asset routing

### 2. Axios Mock API Setup

In `frontend/cms/src/api.ts` and `frontend/web/src/api.ts`:

```typescript
if (import.meta.env.VITE_DEMO_MODE === 'true') {
    const { setupMockApi } = await import('./mockApi');
    setupMockApi(api);
}
```

When `VITE_DEMO_MODE` is true:
- The axios instance is configured with `axios-mock-adapter`
- All API calls are intercepted and return mock data from `demo-data.json`
- No real backend connection is needed

### 3. Mock API Implementation

The `mockApi.ts` files:
- Use `axios-mock-adapter` to intercept HTTP requests
- Load data from `demo-data.json` (exported from the backend)
- Handle dynamic routes like `/shapes/:id` and `/trips/:id/stops`
- Provide a 500ms delay to simulate real API behavior

## Building for Demo/Static Hosting

### Manual Build Process

You can build the frontends in demo mode manually:

**CMS:**
```bash
cd frontend/cms
npm run build:demo
# Output: frontend/cms/dist/
```

**Web Viewer:**
```bash
cd frontend/web
npm run build:demo
# Output: frontend/web/dist/
```

### What Demo Mode Does

1. **Build**: Runs TypeScript compilation and Vite build with `VITE_DEMO_MODE=true`
2. **Base Path**: Sets base path for static asset routing (configurable in `package.json`)
3. **Mock API**: Automatically uses mock data instead of real API calls

### Exporting Demo Data

Before building, you may want to export demo data from your backend:

```bash
cd frontend/cms
npm run demo-data
```

This fetches data from the backend API and saves it to `demo-data.json` in both frontend directories.

### Static Hosting Considerations

For static hosting (e.g., GitHub Pages, Netlify, Vercel, Cloudflare Pages):

1. **SPA Routing**: You'll need to configure your hosting platform to serve `index.html` for all routes. This is typically done with:
   - A `_redirects` file (Netlify, Cloudflare Pages)
   - A `vercel.json` or `netlify.toml` configuration
   - Server configuration for other platforms

2. **Base Path**: The build scripts use base paths (`/gtfs-cms/`, `/gtfs-web/`). Adjust these in `package.json` if deploying to a different path structure.

3. **No Backend Required**: Demo mode uses mock data, so no backend server is needed for static hosting.

## Notes

- Demo mode is essential for static hosting (no backend required)
- The base paths in `build:demo` scripts can be customized for your deployment needs
- All API calls are intercepted and return mock data from `demo-data.json`

